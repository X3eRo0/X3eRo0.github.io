<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
    <title>Year3000 - X3eRo0&#39;s Blog about Reverse Engineering</title>

    <style type="text/css">
        img.wp-smiley,
        img.emoji {
            display: inline !important;
            border: none !important;
            box-shadow: none !important;
            height: 1em !important;
            width: 1em !important;
            margin: 0 .07em !important;
            vertical-align: -0.1em !important;
            background: none !important;
            padding: 0 !important;
        }
    </style>
    <link rel='stylesheet' href='/css/style.css' type='text/css' media='all' />
    <link rel='stylesheet' href='/css/custom.css' type='text/css' media='all' />
    <link rel='stylesheet' href='/css/syntax.css' type='text/css' media='all' />
    <link rel='stylesheet' href='/css/general.css' type='text/css' media='all' />
    <link rel='stylesheet' href='/css/toc.css' type='text/css' media='all' />
    <link rel='stylesheet' href='/css/image.css' type='text/css' media='all' />
</head>

    <body class="two-column">
        <a href="#content">Skip to content</a>
<div class="wrapper">
    <header role="banner" class="banner widgets columns-1">
        <a href="/" rel="home">
            <h1 class="site">X3eRo0&#39;s Blog about Reverse Engineering</h1>
            <p></p>
        </a>
        <nav role="navigation" aria-label="Primary Navigation">

            <ul class="menu">
                <li class="menu-item "><a class="menu__link" href="/about/">ABOUT</a></li>
                <li class="menu-item "><a class="menu__link" href="/crackmes/">CRACKMES</a></li>
                <li class="menu-item "><a class="menu__link" href="/posts/">POSTS</a></li>
            </ul>
            <select onChange="location.href=value;">
                <option value="/about/" class="menu-item menu-item-type-custom menu-item-object-custom" >ABOUT</option>
                <option value="/crackmes/" class="menu-item menu-item-type-custom menu-item-object-custom" >CRACKMES</option>
                <option value="/posts/" class="menu-item menu-item-type-custom menu-item-object-custom" >POSTS</option>
            </select>
        </nav>
    </header>

    <br>
    <div style="width: 100%; max-height: 100px; text-align: center;">
       
</div>

    <div class="breadcrumbs">
        
    </div>
        <div id="content" class="content">

<main role="main">
    <article role="article" class="post type-post format-standard hentry">
        <header class="post-header">
            <h1>Year3000</h1>
            <div class="post-details">
                <a rel="bookmark">
                    <time datetime="2020-02-08T28:64:116">2020-02-08</time>
                </a>
				
<span style="float: right;">
    <div id="fb-root" style="height: 100%;"></div>
    
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2"></script>
    
    <div class="fb-share-button" data-href="https://x3ero0.github.io/posts/year3000/" data-layout="button_count" data-size="small">
        <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fx3ero0.github.io%2fposts%2fyear3000%2f" class="fb-xfbml-parse-ignore">Share</a>
    </div>
    &nbsp;
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Year3000" data-url="https://x3ero0.github.io/posts/year3000/" data-show-count="false">Tweet</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    &nbsp;
    
</span>

            </div>
        </header>

        <div class="post-content">
            <link rel="stylesheet" href="/css/styles/atelier-forest-dark.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<h2 id="year3000-re---nullcon-hackim2020-ctf">Year3000 [RE - Nullcon Hackim2020 CTF]</h2>
<p>Description</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">One day when I came home at lunchtime I heard a funny noise Went out to the
back yard to find out If it was one of those rowdy boys Stood there was my
neighbor called Peter And a flux capacitor. I guess there must be quite some
entropy in a flux capacitor...

Netcat Link : nc re.ctf.nullcon.net 1234
</code></pre></td></tr></table>
</div>
</div><p>we were given 3000 stripped ELF binaries some 64bit binaries and 32bit binaries. the description of the challenge did&rsquo;nt explained what exactly the task was, so i tried to connect to the given netcat link.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">x3ero0 :: year3000 » nc re.ctf.nullcon.net 1234
1252.bin
</code></pre></td></tr></table>
</div>
</div><p>so it was clear that for each binary we need to send the correct password of the binary.
lets reverse engineer one of the binaries.</p>
<pre><code class="language-x86asm" data-lang="x86asm">public start
start proc near
xor     ebp, ebp
pop     esi
mov     ecx, esp
and     esp, 0FFFFFFF0h
push    eax
push    esp             ; stack_end
push    edx             ; rtld_fini
call    sub_542
add     ebx, 1AA0h
lea     eax, (nullsub_1 - 1FC0h)[ebx]
push    eax             ; fini
lea     eax, (sub_7B0 - 1FC0h)[ebx]
push    eax             ; init
push    ecx             ; ubp_av
push    esi             ; argc
push    ds:(off_1FF8 - 1FC0h)[ebx] ; main
call    ___libc_start_main
hlt
start endp
</code></pre><p>i calculated the offset of main function through gdb and it was sub_6D0</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:000006D0
.text:000006D0 ; =============== S U B R O U T I N E =======================================
.text:000006D0
.text:000006D0 ; Attributes: bp-based frame fuzzy-sp
.text:000006D0
.text:000006D0 sub_6D0         proc near               ; DATA XREF: .got:off_1FF8↓o
.text:000006D0
.text:000006D0 var_74          = dword ptr -74h
.text:000006D0 s               = byte ptr -70h
.text:000006D0 var_C           = dword ptr -0Ch
.text:000006D0
.text:000006D0 ; __unwind {
.text:000006D0                 lea     ecx, [esp+4]
.text:000006D4                 and     esp, 0FFFFFFF0h
.text:000006D7                 push    dword ptr [ecx-4]
.text:000006DA                 push    ebp
.text:000006DB                 mov     ebp, esp
.text:000006DD                 push    ebx
.text:000006DE                 push    ecx
.text:000006DF                 sub     esp, 70h
.text:000006E2                 call    sub_550
.text:000006E7                 add     ebx, 18D9h
.text:000006ED                 mov     eax, large gs:14h
.text:000006F3                 mov     [ebp+var_C], eax
.text:000006F6                 xor     eax, eax
.text:000006F8                 mov     eax, ds:(stdin_ptr - 1FC0h)[ebx]
.text:000006FE                 mov     eax, [eax]
.text:00000700                 push    0               ; n
.text:00000702                 push    2               ; modes
.text:00000704                 push    0               ; buf
.text:00000706                 push    eax             ; stream
.text:00000707                 call    _setvbuf
.text:0000070C                 add     esp, 10h
.text:0000070F                 mov     eax, ds:(stdout_ptr - 1FC0h)[ebx]
.text:00000715                 mov     eax, [eax]
.text:00000717                 push    0               ; n
.text:00000719                 push    2               ; modes
.text:0000071B                 push    0               ; buf
.text:0000071D                 push    eax             ; stream
.text:0000071E                 call    _setvbuf
.text:00000723                 add     esp, 10h
.text:00000726                 mov     eax, ds:(stdin_ptr - 1FC0h)[ebx]
.text:0000072C                 mov     eax, [eax]
.text:0000072E                 sub     esp, 4
.text:00000731                 push    eax             ; stream
.text:00000732                 push    64h ; 'd'       ; n
.text:00000734                 lea     eax, [ebp+s]
.text:00000737                 push    eax             ; s
.text:00000738                 call    _fgets
.text:0000073D                 add     esp, 10h
.text:00000740                 sub     esp, 0Ch
.text:00000743                 lea     eax, [ebp+s]
.text:00000746                 push    eax
.text:00000747                 call    sub_64D
.text:0000074C                 add     esp, 10h
.text:0000074F                 mov     [ebp+var_74], eax
.text:00000752                 cmp     [ebp+var_74], 0
.text:00000756                 jz      short loc_76C
.text:00000758                 sub     esp, 0Ch
.text:0000075B                 lea     eax, (aWellDone - 1FC0h)[ebx] ; &quot;Well done&quot;
.text:00000761                 push    eax             ; s
.text:00000762                 call    _puts
.text:00000767                 add     esp, 10h
.text:0000076A                 jmp     short loc_77E
.text:0000076C ; ---------------------------------------------------------------------------
.text:0000076C
.text:0000076C loc_76C:                                ; CODE XREF: sub_6D0+86↑j
.text:0000076C                 sub     esp, 0Ch
.text:0000076F                 lea     eax, (aYouHaveFailed - 1FC0h)[ebx] ; &quot;You have failed&quot;
.text:00000775                 push    eax             ; s
.text:00000776                 call    _puts
.text:0000077B                 add     esp, 10h
.text:0000077E
.text:0000077E loc_77E:                                ; CODE XREF: sub_6D0+9A↑j
.text:0000077E                 cmp     [ebp+var_74], 1
.text:00000782                 setnz   al
.text:00000785                 movzx   eax, al
.text:00000788                 mov     edx, [ebp+var_C]
.text:0000078B                 xor     edx, large gs:14h
.text:00000792                 jz      short loc_799
.text:00000794                 call    sub_820
.text:00000799 ; ---------------------------------------------------------------------------
.text:00000799
.text:00000799 loc_799:                                ; CODE XREF: sub_6D0+C2↑j
.text:00000799                 lea     esp, [ebp-8]
.text:0000079C                 pop     ecx
.text:0000079D                 pop     ebx
.text:0000079E                 pop     ebp
.text:0000079F                 lea     esp, [ecx-4]
.text:000007A2                 retn
.text:000007A2 ; } // starts at 6D0
.text:000007A2 sub_6D0         endp
.text:000007A2
</code></pre><p>lets look at sub_64D</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:0000064D ; =============== S U B R O U T I N E =======================================
.text:0000064D
.text:0000064D ; Attributes: bp-based frame
.text:0000064D
.text:0000064D sub_64D         proc near               ; CODE XREF: sub_6D0+77↓p
.text:0000064D
.text:0000064D var_15          = byte ptr -15h
.text:0000064D var_14          = dword ptr -14h
.text:0000064D var_10          = dword ptr -10h
.text:0000064D var_C           = dword ptr -0Ch
.text:0000064D var_4           = dword ptr -4
.text:0000064D arg_0           = dword ptr  8
.text:0000064D
.text:0000064D ; __unwind {
.text:0000064D                 push    ebp
.text:0000064E                 mov     ebp, esp
.text:00000650                 push    ebx
.text:00000651                 sub     esp, 00000014h
.text:00000654                 call    sub_7A3
.text:00000659                 add     eax, 1967h
.text:0000065E                 mov     [ebp+var_C], 54h ; 'T'
.text:00000665                 mov     [ebp+var_15], 63h ; 'c'
.text:00000669                 mov     [ebp+var_14], 1
.text:00000670                 mov     [ebp+var_10], 0
.text:00000677                 jmp     short loc_696
.text:00000679 ; ---------------------------------------------------------------------------
.text:00000679
.text:00000679 loc_679:                                ; CODE XREF: sub_64D+4F↓j
.text:00000679                 mov     ecx, [ebp+var_10]
.text:0000067C                 mov     edx, [ebp+arg_0]
.text:0000067F                 add     edx, ecx
.text:00000681                 movzx   edx, byte ptr [edx]
.text:00000684                 cmp     [ebp+var_15], dl
.text:00000687                 jz      short loc_692
.text:00000689                 mov     [ebp+var_14], 0
.text:00000690                 jmp     short loc_69E
.text:00000692 ; ---------------------------------------------------------------------------
.text:00000692
.text:00000692 loc_692:                                ; CODE XREF: sub_64D+3A↑j
.text:00000692                 add     [ebp+var_10], 1
.text:00000696
.text:00000696 loc_696:                                ; CODE XREF: sub_64D+2A↑j
.text:00000696                 mov     edx, [ebp+var_10]
.text:00000699                 cmp     edx, [ebp+var_C]
.text:0000069C                 jl      short loc_679
.text:0000069E
.text:0000069E loc_69E:                                ; CODE XREF: sub_64D+43↑j
.text:0000069E                 mov     ecx, [ebp+var_C]
.text:000006A1                 mov     edx, [ebp+arg_0]
.text:000006A4                 add     ecx, edx
.text:000006A6                 sub     esp, 4
.text:000006A9                 push    4               ; n
.text:000006AB                 lea     edx, (dword_2008 - 1FC0h)[eax]
.text:000006B1                 push    edx             ; s2
.text:000006B2                 push    ecx             ; s1
.text:000006B3                 mov     ebx, eax
.text:000006B5                 call    _memcmp
.text:000006BA                 add     esp, 10h
.text:000006BD                 test    eax, eax
.text:000006BF                 jz      short loc_6C8
.text:000006C1                 mov     [ebp+var_14], 0
.text:000006C8
.text:000006C8 loc_6C8:                                ; CODE XREF: sub_64D+72↑j
.text:000006C8                 mov     eax, [ebp+var_14]
.text:000006CB                 mov     ebx, [ebp+var_4]
.text:000006CE                 leave
.text:000006CF                 retn
.text:000006CF ; } // starts at 64D
.text:000006CF sub_64D         endp
.text:000006CF
</code></pre><p>if you see this function and notice that at 0x0000065e a number is loaded into dword [local_ch] and at 0x00000665 a character is loaded into byte [local_15h].</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:0000065E                 mov     [ebp+var_C], 54h ; 'T'
.text:00000665                 mov     [ebp+var_15], 63h ; 'c'
</code></pre><p>the following loop after this simply checks if the user input is &lsquo;c&rsquo; *0x54
then comes a memcmp at 0x6b5. now to statically analyse the arguments passed to memcmp we need to figure out whats going at 0x6b0</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:000006AB                 lea     edx, (unk_2008 - 1FC0h)[eax]
</code></pre><p>now lets see what exactly is the value of eax at this instruction. we scroll a little bit up</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:00000654                 call    sub_7A3
.text:00000659                 add     eax, 1967h
</code></pre><p>lets see what this function is at 0x7a3</p>
<pre><code class="language-x86asm" data-lang="x86asm">.text:000007A3 sub_7A3         proc near               ; CODE XREF: sub_64D+7↑p
.text:000007A3 ; __unwind {
.text:000007A3                 mov     eax, [esp+0]
.text:000007A6                 retn
.text:000007A6 ; } // starts at 7A3
.text:000007A6 sub_7A3         endp
.text:000007A6
</code></pre><p>it returns the address which was pushed on the stack when this function was called.
basically eax = address_of_next_instruction_after_call_0x7a3, so eax = 0x00000659
and then eax += 0x1967, so eax = 0x1fc0.
okay now lets look at the instruction at 0x000006ab again</p>
<pre><code class="language-x86asm" data-lang="x86asm">; from radare2
0x000006ab     lea     edx, dword [eax + 0x48] 
</code></pre><p>so it becomes</p>
<pre><code class="language-x86asm" data-lang="x86asm">; from radare2
0x000006ab     lea     edx, dword [0x1fc0 + 0x48] ; 0x2008
</code></pre><p>and you can actually see that ida already calculated the offset for us.
so memcmp checks that the bytes after &lsquo;c&rsquo; * 0x54 with the dword value at 0x2008
which is</p>
<pre><code class="language-x86asm" data-lang="x86asm">.data:00002008 dword_2008      dd 0A7C6D169h
</code></pre>


<div class="center">
  <img
    class="responsive"
    src="/img/year3000/main.png"
    alt="Dump Of 3.bin"
    decoding="async"
  />
</div>
<p>also one more thing to point out is that this value is always stored at the end of .data section. so the correct password for 3.bin is</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> struct
<span style="color:#ff79c6">print</span> c <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x54</span> <span style="color:#ff79c6">+</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#ff79c6">&lt;</span>I, <span style="color:#bd93f9">0xA7C6D169</span>)

</code></pre></td></tr></table>
</div>
</div><p>output -&gt;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">x3ero0 :: year3000 » python solve_3.py | ./3.bin
Well done
</code></pre></td></tr></table>
</div>
</div><p>so i quickly wrote a script to fetch these values and generate a correct password for all the binaries both 64 bit binaries or 32 bit binaries.</p>
<p>exploit script &ndash;&gt;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">99
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">import</span> base64


context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;critical&#34;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">solve</span>(filename):

	<span style="color:#8be9fd;font-style:italic">file</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(filename, <span style="color:#f1fa8c">&#34;rb&#34;</span>)<span style="color:#ff79c6">.</span>read()
	
	ELF64_Coun <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x816</span>
	ELF64_Valu <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x81d</span>

	ELF32_Coun <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x65e</span>
	ELF32_Valu <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x665</span>


	ELF64_Addr <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x1010</span>
	ELF32_Addr <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x1008</span>

	
	Format <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#8be9fd;font-style:italic">file</span>[<span style="color:#bd93f9">0x04</span>])
	<span style="color:#ff79c6">if</span> (Format <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">2</span>):

		context<span style="color:#ff79c6">.</span>update(arch<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;amd64&#39;</span>, os<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;linux&#39;</span>)

		code_count <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">file</span>[ELF64_Coun : ELF64_Coun<span style="color:#ff79c6">+</span><span style="color:#bd93f9">7</span>]
		code_value <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">file</span>[ELF64_Valu : ELF64_Valu<span style="color:#ff79c6">+</span><span style="color:#bd93f9">4</span>]

		disa_count <span style="color:#ff79c6">=</span> disasm(code_count)
		disa_value <span style="color:#ff79c6">=</span> disasm(code_value)

		code_count <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(disa_count<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;0x&#39;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>], <span style="color:#bd93f9">16</span>)
		code_value <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">int</span>(disa_value<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;0x&#39;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>], <span style="color:#bd93f9">16</span>))

		<span style="color:#6272a4">#value = u64(file[ELF64_Addr : ELF64_Addr+8])</span>
		value <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">file</span>[ELF64_Addr : ELF64_Addr<span style="color:#ff79c6">+</span><span style="color:#bd93f9">8</span>]
		value_n <span style="color:#ff79c6">=</span> u64(value)

		flag <span style="color:#ff79c6">=</span> code_value <span style="color:#ff79c6">*</span> code_count <span style="color:#ff79c6">+</span> value

	<span style="color:#ff79c6">elif</span>(Format <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>):

		context<span style="color:#ff79c6">.</span>update(arch<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;i386&#39;</span>, os<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;linux&#39;</span>)

		code_count <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">file</span>[ELF32_Coun : ELF32_Coun<span style="color:#ff79c6">+</span><span style="color:#bd93f9">7</span>]
		code_value <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">file</span>[ELF32_Valu : ELF32_Valu<span style="color:#ff79c6">+</span><span style="color:#bd93f9">4</span>]

		disa_count <span style="color:#ff79c6">=</span> disasm(code_count)
		disa_value <span style="color:#ff79c6">=</span> disasm(code_value)

		code_count <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(disa_count<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;0x&#39;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>], <span style="color:#bd93f9">16</span>)
		code_value <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">int</span>(disa_value<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;0x&#39;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>], <span style="color:#bd93f9">16</span>))

		<span style="color:#6272a4">#value = u32(file[ELF32_Addr:ELF32_Addr+4])</span>
		value <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">file</span>[ELF32_Addr:ELF32_Addr<span style="color:#ff79c6">+</span><span style="color:#bd93f9">4</span>]
		value_n <span style="color:#ff79c6">=</span> u32(value)
		flag <span style="color:#ff79c6">=</span> code_value <span style="color:#ff79c6">*</span> code_count <span style="color:#ff79c6">+</span> value
	
	<span style="color:#6272a4">#print &#34;[!] file : &#34; + filename</span>
	<span style="color:#6272a4">#print &#34;[!] count: &#34; + hex(code_count)</span>
	<span style="color:#6272a4">#print &#34;[!] value: &#34; + code_value</span>
	<span style="color:#6272a4">#print &#34;[!] numbe: &#34; + hex(value_n)</span>

	<span style="color:#ff79c6">return</span> flag


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">main</span>():


	dump <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
	i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
	p <span style="color:#ff79c6">=</span> remote(<span style="color:#f1fa8c">&#34;re.ctf.nullcon.net&#34;</span>, <span style="color:#bd93f9">1234</span>)
	a <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
	temp <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
	<span style="color:#ff79c6">while</span>(<span style="color:#f1fa8c">&#39;hackim&#39;</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">in</span> dump):

		<span style="color:#6272a4"># i noticed that only 10 files were asked</span>
		<span style="color:#ff79c6">if</span>(i<span style="color:#ff79c6">==</span><span style="color:#bd93f9">10</span>):
			<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;Flag: &#34;</span> <span style="color:#ff79c6">+</span> p<span style="color:#ff79c6">.</span>recvline()
			p<span style="color:#ff79c6">.</span>close()
			<span style="color:#8be9fd;font-style:italic">exit</span>()
		<span style="color:#8be9fd;font-style:italic">file</span> <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvline()<span style="color:#ff79c6">.</span>strip()

		a <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;&gt; &#34;</span>)
		solver <span style="color:#ff79c6">=</span> solve(<span style="color:#8be9fd;font-style:italic">file</span>)
		<span style="color:#6272a4"># .encode(&#39;base64&#39;) doesnt work with bytes </span>
		p<span style="color:#ff79c6">.</span>sendline(base64<span style="color:#ff79c6">.</span>b64encode(solver))
		<span style="color:#6272a4">#print str(solver).encode(&#39;base64&#39;)</span>
		temp <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvline()
		<span style="color:#ff79c6">if</span>(<span style="color:#f1fa8c">&#34;Well done&#34;</span> <span style="color:#ff79c6">in</span> temp):
			<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;[0x</span><span style="color:#f1fa8c">%.4x</span><span style="color:#f1fa8c">]</span><span style="color:#f1fa8c">\t</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">%</span> i<span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">file</span> <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\t</span><span style="color:#f1fa8c">: Well Done&#39;</span>
		<span style="color:#ff79c6">else</span>:
			<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;[+] Failed:</span><span style="color:#f1fa8c">\t</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">file</span> <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\t</span><span style="color:#f1fa8c">dumping recieved data&#34;</span>
			<span style="color:#8be9fd;font-style:italic">exit</span>()
		i <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">1</span>

<span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
	main()
</code></pre></td></tr></table>
</div>
</div><p>

<br>



<br>
</p>
<p>and running this script gives us the flag


<br>



<br>



<script id="asciicast-hWkZOX1XIXtKfZHT3NgaKXzpn" src="https://asciinema.org/a/hWkZOX1XIXtKfZHT3NgaKXzpn.js" async></script>
</p>
        </div>



        <footer class="post-footer">
                
                
                
        
                
                
                
        </footer>
        
<table cellspacing="15" style="width:100%; border: none;">
    <tr>
        <td style="text-align: center; border: none; padding: 0px;">
        </td>
        <td style="text-align: center; border: none; padding: 0px;">
        </td>
    </tr>
</table>

        
    </article>

    

</main>


        <div class="sidebar1 widgets columns-1">

    <aside>
    
</aside>
    <aside class="widget widget_categories">
        <h2>Categories</h2>
        <ul class="widget__list"><li class="cat-item cat-item-2">
                <a href="https://x3ero0.github.io/categories/crackmes/">Crackmes (7)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://x3ero0.github.io/categories/ctf/">CTF (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://x3ero0.github.io/categories/pwn/">Pwn (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://x3ero0.github.io/categories/rev/">Rev (5)</a>
            </li>
        </ul>
    </aside>

    <aside class="widget widget_recent_entries">
        <h2>Recent Posts</h2>
        <ul>
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/hyperion/">Hyperion Pwn Writeup [Google CTF 2017 Finals]</a>
                    </li>
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/float-writeup/">Float Writeup</a>
                    </li>
                
            
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/hell86_from_ttlhacker/">Hell86 - ttlhacker</a>
                    </li>
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/reversing_a_malware_in_disguise/">Reversing a malware in disguise</a>
                    </li>
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/watevr_repyc/">Watevr_repyc</a>
                    </li>
                
            
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/hsctf-license/">HSCTF License</a>
                    </li>
                
            
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/plaintext_attack_on_zip_legacy_crypto/">Plaintext Attack on Zip</a>
                    </li>
                
            
        </ul>
    </aside>

    <aside class="widget widget_recent_entries">
        <h2>Recent Posts</h2>
        <ul>
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/hyperion/">Hyperion Pwn Writeup [Google CTF 2017 Finals]</a>
                    </li>
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/float-writeup/">Float Writeup</a>
                    </li>
                
            
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/hell86_from_ttlhacker/">Hell86 - ttlhacker</a>
                    </li>
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/reversing_a_malware_in_disguise/">Reversing a malware in disguise</a>
                    </li>
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/watevr_repyc/">Watevr_repyc</a>
                    </li>
                
            
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/hsctf-license/">HSCTF License</a>
                    </li>
                
            
                
            
                
                    <li>
                        <a href="https://x3ero0.github.io/posts/plaintext_attack_on_zip_legacy_crypto/">Plaintext Attack on Zip</a>
                    </li>
                
            
        </ul>
    </aside>
</div>
        </div>
        </div>
<footer role="contentinfo" class="document-footer contentinfo widgets columns-1">

    <aside class="widget widget_text">
        <div class="textwidget">
            <p>© X3eRo0&#39;s Blog about Reverse Engineering</p>
        </div>
    </aside>
</footer>
</div>

    </body>
</html>
